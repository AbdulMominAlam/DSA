import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

sns.set(style="whitegrid")

# 1) Load cleaned datasets
oecd = pd.read_csv('/content/oecd_cleaned.csv')
macro = pd.read_csv('/content/macro_cleaned.csv')
company = pd.read_csv('/content/company_cleaned.csv')

# 2) Inspect columns
print("OECD columns:", oecd.columns.tolist())
print("Macro columns:", macro.columns.tolist())
print("Company columns:", company.columns.tolist())

# 3) Merge
if 'Year' in oecd.columns and 'Year' in macro.columns:
    merged = pd.merge(oecd, macro, on=['Country', 'Year'], how='inner')
else:
    merged = pd.merge(oecd, macro, on='Country', how='inner')

print("Merged columns:", merged.columns.tolist())
print("Merged shape:", merged.shape)
display(merged.head())

# 4) Identify which macro columns hold the indicators
#    (anything beyond Country, Year, R&D_Spend_MillionUSD)
base_cols = {'Country', 'Year', 'R&D_Spend_MillionUSD', 'Company_R&D_Spend_MillionUSD'}
macro_inds = [c for c in merged.columns if c not in base_cols]

if len(macro_inds) >= 3:
    # assume first three are GDP, Inflation, Unemployment
    rename_map = {
        macro_inds[0]: 'GDP_Growth',
        macro_inds[1]: 'Inflation',
        macro_inds[2]: 'Unemployment'
    }
    merged = merged.rename(columns=rename_map)
    print("Renamed macro columns:", rename_map)
else:
    raise ValueError(f"Expected at least 3 macro columns, found: {macro_inds}")

# 5) Drop any rows missing key values
merged = merged.dropna(subset=['R&D_Spend_MillionUSD', 'GDP_Growth', 'Inflation', 'Unemployment'])
print("After dropping NA, shape:", merged.shape)

# 6) Plot 1: Average R&D Spending by Country
plt.figure(figsize=(12, 6))
sns.barplot(data=merged, x='R&D_Spend_MillionUSD', y='Country', estimator='mean')
plt.title("Average R&D Spending by Country (2010â€“2023)")
plt.xlabel("R&D Spending (Million USD)")
plt.ylabel("Country")
plt.tight_layout()
plt.show()



# 8) Plot 3: Scatter Plots
plt.figure(figsize=(16, 4))

plt.subplot(1, 3, 1)
sns.scatterplot(data=merged, x='GDP_Growth', y='R&D_Spend_MillionUSD', hue='Country')
plt.title("R&D vs GDP Growth")

plt.subplot(1, 3, 2)
sns.scatterplot(data=merged, x='Inflation', y='R&D_Spend_MillionUSD', hue='Country')
plt.title("R&D vs Inflation")

plt.subplot(1, 3, 3)
sns.scatterplot(data=merged, x='Unemployment', y='R&D_Spend_MillionUSD', hue='Country')
plt.title("R&D vs Unemployment")

plt.tight_layout()
plt.show()
